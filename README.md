# Telegram Bot для распределения заявок

Бот для автоматического распределения заявок между пользователями с учетом категорий и городов.

## Основные функции

- Автоматический сбор заявок из групп
- Распределение заявок между пользователями по заданному алгоритму
- Настройка категорий и городов для каждого пользователя
- Статистика по заявкам
- Админ-панель для управления

## Установка

1. Клонируйте репозиторий:
```bash
git clone [repository_url]
cd lead_bot
```

2. Создайте виртуальное окружение и активируйте его:
```bash
python3 -m venv venv
source venv/bin/activate  # для Linux/Mac
# или
venv\Scripts\activate  # для Windows
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Создайте файл .env и настройте переменные окружения:
```env
BOT_TOKEN=your_bot_token
DATABASE_URL=sqlite+aiosqlite:///bot.db
```

## Запуск

```bash
python main.py
```

## Команды бота

### Пользовательские команды:
- `/start` - начало работы
- `/help` - справка
- `/categories` - выбор категорий заявок
- `/cities` - выбор городов
- `/status` - текущие настройки

### Админ-команды:
- `/admin` - список админ-команд
- `/stats` - статистика по заявкам
- `/users` - список пользователей
- `/add_user` - добавить пользователя
- `/remove_user` - удалить пользователя
- `/settings` - настройки бота

## Алгоритм распределения заявок

1. Заявка приходит в группу
2. Бот определяет категорию и город
3. Находит подходящих пользователей
4. Распределяет заявку между ними с интервалом в 3 часа
5. Чередует порядок отправки (прямой/обратный) для равномерного распределения

## Статусы заявок

- Актуальная
- Не актуальна (недоступен)
- Не актуальна (отказ)
- В работе
- Замер
- Думает
- Договор

## Разработка

### Структура проекта
```
lead_bot/
├── bot/
│   ├── core/
│   │   ├── config.py
│   │   └── database.py
│   ├── handlers/
│   │   ├── admin.py
│   │   ├── base.py
│   │   └── settings.py
│   ├── models/
│   │   ├── base.py
│   │   ├── lead.py
│   │   └── user.py
│   └── services/
│       ├── distribution.py
│       └── parser.py
├── main.py
└── requirements.txt
```

### База данных

Используется SQLite с асинхронным драйвером aiosqlite. Схема базы данных включает:
- Пользователи (users)
- Заявки (leads)
- Распределение заявок (lead_distributions)

## Поддержка

По всем вопросам обращайтесь к администратору бота. 