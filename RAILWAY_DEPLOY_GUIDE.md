# Пошаговая инструкция по деплою на Railway

## Шаг 1: Настройка переменных окружения

1. Перейдите на вкладку **Variables** в вашем проекте Railway
2. Добавьте следующие обязательные переменные:
   - `BOT_TOKEN` - токен вашего Telegram бота
   - `DATABASE_URL` - URL для подключения к PostgreSQL (если вы добавили PostgreSQL сервис, эта переменная будет добавлена автоматически)
   - `PORT` - установите значение `8000`
   - `PYTHON_VERSION` - установите значение `3.9.18`
   - `RENDER` - установите значение `1`

## Шаг 2: Добавление сервисов (если нужно)

1. Нажмите кнопку **New** в верхнем меню
2. Выберите **Database** → **PostgreSQL**
3. После создания базы данных, переменная `DATABASE_URL` будет добавлена автоматически
4. Если нужен Redis, добавьте его аналогичным образом и используйте переменную `REDIS_URL`

## Шаг 3: Деплой проекта

1. Первый деплой будет использовать упрощенное приложение healthcheck для проверки работоспособности
2. После успешного деплоя healthcheck, запустите скрипт `deploy_main_app.sh` для переключения на основное приложение:
   ```bash
   ./deploy_main_app.sh
   ```

## Шаг 4: Мониторинг деплоя

1. Вернитесь на вкладку **Deployments**
2. Дождитесь завершения нового деплоя
3. Если деплой успешен, вы увидите зеленый статус
4. Если возникли ошибки, проверьте логи, нажав на "View logs"

## Решение проблем

### Ошибка Healthcheck

Если вы видите ошибку "Healthcheck failure":

1. Перейдите на вкладку **Settings**
2. В разделе **Health Check** проверьте, что путь установлен на `/`
3. Установите таймаут на 60 секунд

### Ошибки с переменными окружения

Если приложение не может найти переменные окружения:

1. Проверьте, что все необходимые переменные добавлены на вкладке **Variables**
2. Убедитесь, что имена переменных указаны правильно (с учетом регистра)

### Ошибки с базой данных

Если есть проблемы с подключением к базе данных:

1. Проверьте, что сервис PostgreSQL добавлен и работает
2. Убедитесь, что переменная `DATABASE_URL` корректно установлена
3. Проверьте, что миграции выполняются успешно

## Дополнительные рекомендации

1. **Логирование**: Добавьте подробное логирование, чтобы легче отлаживать проблемы
2. **Постепенный деплой**: Сначала убедитесь, что простое приложение работает, затем добавляйте сложные компоненты
3. **Проверка переменных окружения**: Убедитесь, что все необходимые переменные окружения настроены правильно
4. **Мониторинг**: Регулярно проверяйте логи и метрики вашего приложения 